{% extends "layouts/base.html" %} {% load static %} {% block header %} 
{% include 'includes/navigation.html' %} {% endblock header %} {% block content %}

<main>
  {% include 'includes/pre-loader.html' %}

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
  <style>
    form {
      width: 500px;
      height: auto;
      padding: 100px 20px 20px 20px;
      box-shadow: rgba(0, 0, 0, 0.35) 0px 5px 15px;
      margin: 50px auto;
      border-radius: 10px;
    }
    form p {
      text-align: center;
    }

    form h3 {
      text-align: center;
    }
  </style>

  <form action="" method="POST">
    {% csrf_token %}
    <h3><strong>Verify Email</strong></h3>
    <div class="mb-3">
      <label class="form-label">OTP</label>
      <input
        type="text"
        class="form-control"
        name="otp"
        id="otp"
        placeholder="Enter OTP"
      />
    </div>

    <button class="btn btn-primary" style="width: 100%">
      Activate Account
    </button>
    <script>
      $("#otp").change(function () {
        let otp = $("#otp").val();
        console.log("OTP: ", otp);

        if (otp == "{{otp}}") {
          console.log("OTP Matched!");

          $.ajax({
            type: "POST",
            url: "{% url 'verifyEmail' %}",
            data: {
              otp: otp,
              first_name: "{{first_name}}",
              last_name: "{{last_name}}",
              email: "{{email}}",
              password1: "{{password1}}",
              password2: "{{password2}}",
            },
            success: function (data) {
              console.log("OTP works fine");
              window.location.href = "/";
            },
          });
        }
      });
    </script>

    {% comment %}
    <p>Need a new OTP? <a href="{% url 'resend-otp' %}">Resend OTP</a></p>
    {% endcomment %}
  </form>
</main>
{% endblock content %} {% block footer %} {% include 'includes/footer.html' %}
{% endblock footer %}
